<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buy IDs</title>

<style>
*{
  box-sizing:border-box;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(180deg,#4f46e5,#6d6af5);
  padding:18px;
}
.container{max-width:420px;margin:auto}
.card{
  background:#fff;
  border-radius:22px;
  padding:20px;
  margin-bottom:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.25);
}
h2{text-align:center;color:#4f46e5;margin:0 0 14px}
.sub{text-align:center;color:#666;font-size:13px;margin-bottom:16px}

.options{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
.box{
  background:#f4f6ff;
  border-radius:18px;
  padding:18px;
  text-align:center;
  font-weight:700;
  cursor:pointer;
  border:2px solid transparent;
}
.box small{display:block;color:#555;font-weight:500;margin-top:6px}
.box.active{background:#eef0ff;border-color:#4f46e5;color:#4f46e5}

input{
  width:100%;
  padding:15px;
  border-radius:16px;
  border:1.5px solid #ddd;
  margin-top:14px;
  font-size:15px;
}

button{
  width:100%;
  padding:16px;
  border:none;
  border-radius:32px;
  font-size:16px;
  font-weight:700;
  margin-top:18px;
  background:#b5b5b5;
  color:#fff;
}
button.active{
  background:linear-gradient(90deg,#ff4d4d,#ff2f7b);
}
button.copy{background:#22c55e}

/* payment */
.pay-info{text-align:center}
.amount{font-size:20px;font-weight:800}
.qr-wrap{display:flex;justify-content:center;margin:14px 0}

/* processing */
.processing{
  text-align:center;
  padding:30px 0;
}
.spinner{
  width:50px;height:50px;
  border:5px solid #e5e7eb;
  border-top:5px solid #4f46e5;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto 14px;
}
@keyframes spin{
  0%{transform:rotate(0deg)}
  100%{transform:rotate(360deg)}
}
.processing p{
  font-weight:600;
  color:#333;
}

/* success */
pre{
  background:#f8fafc;
  border-radius:18px;
  padding:16px;
  font-size:14px;
  white-space:pre-wrap;
  line-height:1.45;
}
.success-title{
  text-align:center;
  font-size:20px;
  font-weight:800;
  color:#16a34a;
  margin-bottom:12px;
}
</style>
</head>

<body>
<div class="container">

<!-- SELECT -->
<div class="card" id="select">
<h2>Select IDs</h2>
<div class="sub">Choose quantity</div>

<div class="options">
  <div class="box" onclick="setQty(1,this)">1 ID<small>Instant</small></div>
  <div class="box" onclick="setQty(2,this)">2 IDs<small>Best</small></div>
  <div class="box" onclick="setQty(5,this)">5 IDs<small>Popular</small></div>
  <div class="box" onclick="setQty(10,this)">10 IDs<small>Bulk</small></div>
</div>

<input id="custom" type="number" placeholder="Custom quantity" oninput="customQty()">
<button id="buy" onclick="pay()">Buy Now</button>
</div>

<!-- PAYMENT -->
<div class="card" id="payment" style="display:none">
<h2>Complete Payment</h2>

<div class="pay-info">
Qty: <b id="pq"></b><br>
<div class="amount">₹ <span id="pa"></span></div>
</div>

<div class="qr-wrap">
<img id="qr" width="220">
</div>

<input id="utr" placeholder="Enter UTR / Reference">
<button class="active" onclick="submit()">Submit Payment</button>
</div>

<!-- PROCESSING -->
<div class="card" id="processing" style="display:none">
<div class="processing">
  <div class="spinner"></div>
  <p>Payment processing…<br>Please wait for admin verification</p>
</div>
</div>

<!-- SUCCESS -->
<div class="card" id="success" style="display:none">
<div class="success-title">✅ Payment Successful</div>
<pre id="ids"></pre>
<button class="copy" onclick="copy()">Copy All IDs</button>
</div>

</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {getDatabase,ref,onValue,push,update} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const app=initializeApp({
 apiKey:"AIzaSyChBGm2SO7uuW9gIhpFH-MDFzWs0gp9eps",
 databaseURL:"https://database-7209-default-rtdb.firebaseio.com"
});
const db=getDatabase(app);

let qty=0,price=0,orderId="";
const upi="bharatpe@upi";

onValue(ref(db,"settings/pricePerId"),s=>price=s.val()||0);

window.setQty=(q,e)=>{
 qty=q;
 document.querySelectorAll(".box").forEach(b=>b.classList.remove("active"));
 e.classList.add("active");
 buy.classList.add("active");
 buy.innerText=`Buy ₹${qty*price}`;
};

window.customQty=()=>{
 qty=+custom.value;
 if(qty>0){
  buy.classList.add("active");
  buy.innerText=`Buy ₹${qty*price}`;
 }
};

window.pay=()=>{
 orderId=push(ref(db,"orders"),{
  qty,amount:qty*price,status:"pending",time:Date.now()
 }).key;

 select.style.display="none";
 payment.style.display="block";
 pq.innerText=qty;
 pa.innerText=qty*price;
 qr.src=`https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=upi://pay?pa=${upi}&am=${qty*price}&cu=INR`;
};

window.submit=()=>{
 if(!utr.value) return alert("UTR required");

 update(ref(db,"orders/"+orderId),{utr:utr.value});

 payment.style.display="none";
 processing.style.display="block";

 onValue(ref(db,"orders/"+orderId+"/status"),s=>{
  if(s.val()==="verified") loadIDs();
 });
};

function loadIDs(){
 onValue(ref(db,"deliveries/"+orderId),snap=>{
  let out="";
  snap.forEach(c=>{
   let v=c.val();
   out+=`${v.username}\n${v.password}\n${v.phone}\n${v.email}\n\n------------------\n\n`;
  });
  ids.innerText=out;
  processing.style.display="none";
  success.style.display="block";
 },{onlyOnce:true});
}

window.copy=()=>navigator.clipboard.writeText(ids.innerText);
</script>
</body>
</html>
