<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Buy IDs</title>
<style>
*{font-family:Arial}
body{background:#6a6fdc;padding:15px}
.card{background:#fff;border-radius:18px;padding:18px;margin-bottom:15px}
.options{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.box{background:#eef;padding:15px;text-align:center;border-radius:14px;cursor:pointer}
.box.active{background:#dfe2ff;font-weight:bold}
button{padding:14px;width:100%;border:none;border-radius:30px;font-size:16px}
button.active{background:#ff2f7b;color:#fff}
pre{background:#f8fafc;padding:15px;border-radius:12px}
.copy{background:#22c55e;color:#fff}
</style>
</head>

<body>

<div class="card" id="select">
<h3>Select Quantity</h3>
<div class="options">
<div class="box" onclick="setQty(1,this)">1 ID</div>
<div class="box" onclick="setQty(2,this)">2 IDs</div>
<div class="box" onclick="setQty(5,this)">5 IDs</div>
<div class="box" onclick="setQty(10,this)">10 IDs</div>
</div>
<input id="custom" type="number" placeholder="Custom Qty" oninput="customQty()">
<button id="buy" onclick="pay()">Buy</button>
</div>

<div class="card" id="payment" style="display:none">
<h3>Payment</h3>
<p>Qty: <b id="pq"></b></p>
<p>Total: ₹<b id="pa"></b></p>
<img id="qr" width="200"><br>
<input id="utr" placeholder="Enter UTR">
<button class="active" onclick="submit()">Submit</button>
</div>

<div class="card" id="success" style="display:none">
<h3>✅ IDs Delivered</h3>
<pre id="ids"></pre>
<button class="copy" onclick="copy()">Copy All IDs</button>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {getDatabase,ref,onValue,push,update} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const app=initializeApp({
 apiKey:"AIzaSyChBGm2SO7uuW9gIhpFH-MDFzWs0gp9eps",
 databaseURL:"https://database-7209-default-rtdb.firebaseio.com"
});
const db=getDatabase(app);

let qty=0,price=0,orderId="";
const upi="bharatpe@upi";

onValue(ref(db,"settings/pricePerId"),s=>price=s.val()||0);

window.setQty=(q,e)=>{
 qty=q;
 document.querySelectorAll(".box").forEach(b=>b.classList.remove("active"));
 e.classList.add("active");
 buy.classList.add("active");
 buy.innerText=`Buy ₹${qty*price}`;
};

window.customQty=()=>{
 qty=+custom.value;
 if(qty>0){
  buy.classList.add("active");
  buy.innerText=`Buy ₹${qty*price}`;
 }
};

window.pay=()=>{
 orderId=push(ref(db,"orders"),{
  qty,amount:qty*price,status:"pending",time:Date.now()
 }).key;

 select.style.display="none";
 payment.style.display="block";
 pq.innerText=qty;
 pa.innerText=qty*price;
 qr.src=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=${upi}&am=${qty*price}&cu=INR`;
};

window.submit=()=>{
 if(!utr.value) return alert("UTR required");
 update(ref(db,"orders/"+orderId),{utr:utr.value});

 onValue(ref(db,"orders/"+orderId+"/status"),s=>{
  if(s.val()==="verified") loadIDs();
 });
};

function loadIDs(){
 onValue(ref(db,"deliveries/"+orderId),snap=>{
  let out="";
  snap.forEach(c=>{
   let v=c.val();
   out+=`${v.username}\n${v.password}\n${v.phone}\n${v.email}\n\n--------------------\n\n`;
  });
  ids.innerText=out;
  payment.style.display="none";
  success.style.display="block";
 },{onlyOnce:true});
}

window.copy=()=>navigator.clipboard.writeText(ids.innerText);
</script>
</body>
</html>
