<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ID Purchase</title>

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{
  margin:0;
  background:linear-gradient(180deg,#6a6fdc,#8e8bdc);
  padding:15px;
}
.card{
  background:#fff;
  border-radius:18px;
  padding:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.2);
  margin-bottom:15px;
}
h2{text-align:center;color:#6a6fdc}
.options{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}
.box{
  background:#f1f2ff;
  padding:15px;
  text-align:center;
  border-radius:14px;
  cursor:pointer;
  border:2px solid transparent;
}
.box.active{
  border-color:#6a6fdc;
  background:#e5e7ff;
}
.custom input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
  margin-top:10px;
}
button{
  width:100%;
  margin-top:18px;
  padding:14px;
  border:none;
  border-radius:30px;
  font-size:16px;
  color:#fff;
  background:#aaa;
  cursor:not-allowed;
}
button.active{
  background:linear-gradient(90deg,#ff4d4d,#ff2f7b);
  cursor:pointer;
  animation:blink 1s infinite;
}
@keyframes blink{
  0%{opacity:1}
  50%{opacity:.6}
  100%{opacity:1}
}
#payment{display:none}
.qr{
  background:#f1f2ff;
  padding:15px;
  border-radius:14px;
  text-align:center;
}
input.utr{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
  margin-top:12px;
}
.note{
  font-size:13px;
  color:#444;
  margin-top:10px;
  text-align:center;
}
</style>
</head>

<body>

<div class="card" id="selectPage">
  <h2>Select Number of IDs</h2>

  <div class="options">
    <div class="box" onclick="selectQty(1,this)">1 ID<br>‚Çπ<span class="p1">--</span></div>
    <div class="box" onclick="selectQty(2,this)">2 IDs<br>‚Çπ<span class="p2">--</span></div>
    <div class="box" onclick="selectQty(5,this)">5 IDs<br>‚Çπ<span class="p5">--</span></div>
    <div class="box" onclick="selectQty(10,this)">10 IDs<br>‚Çπ<span class="p10">--</span></div>
  </div>

  <div class="custom">
    <input type="number" id="customQty" placeholder="Custom quantity" oninput="customQty()">
  </div>

  <button id="buyBtn" disabled onclick="openPayment()">Buy Now</button>
</div>

<div class="card" id="payment">
  <h2>Payment</h2>

  <p><b>Quantity:</b> <span id="pQty"></span></p>
  <p><b>Total Amount:</b> ‚Çπ<span id="pAmount"></span></p>

  <div class="qr">
    <img id="qrImg" width="220">
    <p>UPI ID: <b>bharatpe@upi</b></p>
  </div>

  <input class="utr" id="utr" placeholder="Enter UTR">

  <button class="active" onclick="submitOrder()">Submit Payment</button>

  <div class="note">‚è≥ Verification may take up to 5 minutes</div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyChBGm2SO7uuW9gIhpFH-MDFzWs0gp9eps",
  authDomain: "database-7209.firebaseapp.com",
  databaseURL: "https://database-7209-default-rtdb.firebaseio.com",
  projectId: "database-7209"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let pricePerId = 0;
let qty = 0, total = 0;

// üî• LIVE PRICE LISTENER
onValue(ref(db,"settings/pricePerId"),snap=>{
  pricePerId = snap.val() || 0;
  document.querySelector(".p1").innerText = pricePerId;
  document.querySelector(".p2").innerText = pricePerId*2;
  document.querySelector(".p5").innerText = pricePerId*5;
  document.querySelector(".p10").innerText = pricePerId*10;
});

// SELECT QTY
window.selectQty = (q,el)=>{
  qty=q;
  total=qty*pricePerId;
  document.querySelectorAll(".box").forEach(b=>b.classList.remove("active"));
  el.classList.add("active");
  enableBuy();
};

window.customQty = ()=>{
  qty = Number(customQty.value);
  total = qty*pricePerId;
  document.querySelectorAll(".box").forEach(b=>b.classList.remove("active"));
  enableBuy();
};

function enableBuy(){
  if(qty>0){
    buyBtn.disabled=false;
    buyBtn.classList.add("active");
    buyBtn.innerText = `Buy Now ‚Äì ‚Çπ${total}`;
  }
}

window.openPayment = ()=>{
  selectPage.style.display="none";
  payment.style.display="block";
  pQty.innerText = qty;
  pAmount.innerText = total;

  const upiLink =
  `upi://pay?pa=bharatpe@upi&pn=IDSTORE&am=${total}&cu=INR`;

  qrImg.src =
  "https://api.qrserver.com/v1/create-qr-code/?size=220x220&data="+
  encodeURIComponent(upiLink);
};

window.submitOrder = ()=>{
  if(!utr.value) return alert("Enter UTR");

  push(ref(db,"orders"),{
    qty,
    amount: total,
    utr: utr.value,
    status:"pending",
    time:Date.now()
  });

  alert("Payment submitted. Please wait for verification.");
};
</script>

</body>
</html>
